@using Asistant.Areas.Admin.Models
@model PagedViewModel<CommentViewModel>
@* نکته: مطمئن شوید که CommentViewModel را در پروژه خود ساخته‌اید و شامل فیلد HomeServiceName است *@
@{
    ViewData["Title"] = "مدیریت کامنت‌ها";
}

<h4>مدیریت کامنت‌ها</h4>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}
@if (TempData["Succeed"] != null)
{
    <div class="alert alert-success">
        @TempData["Succeed"]
    </div>
}


<div class="mb-3">
    <a class="btn btn-secondary btn-sm"
       asp-area="Admin"
       asp-controller="CommentManagement"
       asp-action="Index"
       asp-route-showAll="true">
        نمایش همه
    </a>
    <a class="btn btn-info btn-sm text-white"
       asp-area="Admin"
       asp-controller="CommentManagement"
       asp-action="Index"
       asp-route-showAll="false">
        نمایش کامنتهای تعیین وضعیت نشده
    </a>
</div>

@if (Model.Items is not null && Model.Items.Any())
{
    <table class="table table-striped table-hover text-center align-middle">
        <thead class="table-light">
            <tr>
                <th>شناسه</th>
                <th>نام کاربر</th>
                <th>نام کاشناس</th>
                <th>نام سرویس</th>
                <th>عنوان</th>
                
                <th>متن کامنت</th>
                <th>امتیاز</th>
                <th>تاریخ ثبت</th>
                <th>وضعیت</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Items)
            {
                <tr>
                    <td>@item.Id</td>
                    <td>@item.CustomerName</td>
                    <td>@item.ExpertName</td>
                    <td>
                        <span class="badge bg-info text-dark">@item.HomeServiceName</span>
                    </td>
                    <td class="text-start" style="max-width: 300px;">
                        @item.Title
                    </td>
                    <td class="text-start" style="max-width: 300px;">
                        @item.Description
                    </td>
                    <td class="text-start" style="max-width: 300px;">
                        @item.Rate.ToString()
                    </td>
                    <td>
                        <div class="text-center dir-rtl">
                            @item.CreatedAt
                        </div>
                    </td>
                    <td>
                        @if (item.Status == "Pending")
                        {
                            <span class="badge bg-warning text-dark">در انتظار تایید</span>
                        }
                        else if (item.Status == "Accept")
                        {
                            <span class="badge bg-success">تایید شده</span>
                        }
                        else if (item.Status == "Reject")
                        {
                            <span class="badge bg-danger">تایید نشده</span>
                        }
                    </td>
                   

                    <td>
                        <div class="btn-group" role="group">

                           
                            @if (item.Status == "Pending")
                            {
                                <form method="post" class="d-inline"
                                      asp-area="Admin"
                                      asp-controller="CommentManagement"
                                      asp-action="AcceptComment"
                                      asp-route-id="@item.Id">
                                    <button type="submit" class="btn btn-success btn-sm" title="تایید کامنت">
                                        ✔ تایید
                                    </button>
                                </form>

                                <form method="post" class="d-inline"
                                      asp-area="Admin"
                                      asp-controller="CommentManagement"
                                      asp-action="RejectComment"
                                      asp-route-id="@item.Id">
                                    <button type="submit" class="btn btn-danger btn-sm" title="رد کامنت">
                                        ✖ رد
                                    </button>
                                </form>
                            }

                        
                            else if (item.Status == "Accept")
                            {
                                <form method="post" class="d-inline"
                                      asp-area="Admin"
                                      asp-controller="CommentManagement"
                                      asp-action="RejectComment"
                                      asp-route-id="@item.Id"
                                      onsubmit="return confirm('این کامنت در حال حاضر تایید شده است. آیا می‌خواهید آن را رد کنید؟');">
                                    <button type="submit" class="btn btn-warning btn-sm" title="تغییر به رد شده">
                                        ✖ رد
                                    </button>
                                </form>
                            }
                            else if (item.Status == "Reject")
                            {
                                <form method="post" class="d-inline"
                                      asp-area="Admin"
                                      asp-controller="CommentManagement"
                                      asp-action="AcceptComment"
                                      asp-route-id="@item.Id"
                                      onsubmit="return confirm('این کامنت رد شده است. آیا می‌خواهید آن را تایید کنید؟');">
                                    <button type="submit" class="btn btn-success btn-sm" title="تغییر به تایید شده">
                                        ✔ تایید
                                    </button>
                                </form>
                            }


                            <form method="post" class="d-inline"
                                  asp-area="Admin"
                                  asp-controller="CommentManagement"
                                  asp-action="DeleteComment"
                                  asp-route-id="@item.Id"
                                  onsubmit="return confirm('آیا از حذف این کامنت مطمئن هستید؟');">
                                <button type="submit" class="btn btn-danger btn-sm" title="حذف">
                                    🗑
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

   
    <nav>
        <ul class="pagination justify-content-center">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link"
                       asp-area="Admin"
                       asp-controller="CommentManagement"
                       asp-action="Index"
                       asp-route-pageNumber="@i"
                       asp-route-pageSize="@Model.PageSize"
                       asp-route-showAll="@Context.Request.Query["showAll"]">
                        
                        @i
                    </a>
                </li>
            }
        </ul>
    </nav>
}
else
{
    <div class="alert alert-info text-center">
        هیچ کامنتی برای نمایش وجود ندارد.
    </div>
}